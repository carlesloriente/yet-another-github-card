/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/graphql-request@7.0.0/build/entrypoints/main.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import"node:fs/promises";import{Kind as e}from"/npm/graphql@16.8.1/+esm";import{OperationTypeNode as r}from"/npm/graphql@16.8.1/language/ast.js/+esm";import{parse as t}from"/npm/graphql@16.8.1/language/parser.js/+esm";import{print as s}from"/npm/graphql@16.8.1/language/printer.js/+esm";class a extends Error{response;request;constructor(e,r){super(`${a.extractMessage(e)}: ${JSON.stringify({response:e,request:r})}`),Object.setPrototypeOf(this,a.prototype),this.response=e,this.request=r,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${String(e.status)})`}}const n=e=>e.toUpperCase(),o=e=>"function"==typeof e?e():e,i=(e,r)=>e.map(((e,t)=>[e,r[t]])),u=e=>{let r={};return e instanceof Headers?r=c(e):Array.isArray(e)?e.forEach((([e,t])=>{e&&void 0!==t&&(r[e]=t)})):e&&(r=e),r},c=e=>{const r={};return e.forEach(((e,t)=>{r[t]=e})),r},l=e=>e instanceof Error?e:new Error(String(e)),d=e=>"object"==typeof e&&null!==e&&"then"in e&&"function"==typeof e.then&&"catch"in e&&"function"==typeof e.catch&&"finally"in e&&"function"==typeof e.finally,h=e=>{throw new Error(`Unhandled case: ${String(e)}`)},p=e=>"object"==typeof e&&null!==e&&!Array.isArray(e),f=async(...e)=>{const r=m(e);return new H(r.url).batchRequests(r)},m=e=>1===e.length?e[0]:{url:e[0],documents:e[1],requestHeaders:e[2],signal:void 0},g=async(...e)=>{const[r,t,...s]=e,a=q(r,t,...s);return new H(a.url).rawRequest({...a})},q=(e,r,...t)=>{const[s,a]=t;return"string"==typeof e?{url:e,query:r,variables:s,requestHeaders:a,signal:void 0}:e},y="Accept",w="Content-Type",v="application/json",b="application/graphql-response+json",x=e=>e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),O=e=>{try{if(Array.isArray(e))return{_tag:"Batch",executionResults:e.map(S)};if(p(e))return{_tag:"Single",executionResult:S(e)};throw new Error(`Invalid execution result: result is not object or array. \nGot:\n${String(e)}`)}catch(e){return e}},S=e=>{if("object"!=typeof e||null===e)throw new Error("Invalid execution result: result is not object");let r,t,s;if("errors"in e){if(!p(e.errors)&&!Array.isArray(e.errors))throw new Error("Invalid execution result: errors is not plain object OR array");r=e.errors}if("data"in e){if(!p(e.data)&&null!==e.data)throw new Error("Invalid execution result: data is not plain object");t=e.data}if("extensions"in e){if(!p(e.extensions))throw new Error("Invalid execution result: extensions is not plain object");s=e.extensions}return{data:t,errors:r,extensions:s}},N=e=>Array.isArray(e.errors)?e.errors.length>0:Boolean(e.errors),E=r=>"object"==typeof r&&null!==r&&"kind"in r&&r.kind===e.OPERATION_DEFINITION,j=(e,a)=>{const n="string"==typeof e?e:s(e);let o,i=!1;if(a)return{expression:n,isMutation:i,operationName:o};const u=(e=>{try{const r=e();return d(r)?r.catch((e=>l(e))):r}catch(e){return l(e)}})((()=>"string"==typeof e?t(e):e));return u instanceof Error?{expression:n,isMutation:i,operationName:o}:(o=(e=>{let r;const t=e.definitions.filter(E);return 1===t.length&&(r=t[0].name?.value),r})(u),i=(e=>{let t=!1;const s=e.definitions.filter(E);return 1===s.length&&(t=s[0].operation===r.MUTATION),t})(u),{expression:n,operationName:o,isMutation:i})},C=JSON,M=async e=>{const r={...e,method:"Single"===e.request._tag?e.request.document.isMutation?"POST":n(e.method??"post"):e.request.hasMutations?"POST":n(e.method??"post"),fetchOptions:{...e.fetchOptions,errorPolicy:e.fetchOptions.errorPolicy??"none"}},t=P(r.method),s=await t(r);if(!s.ok)return new a({status:s.status,headers:s.headers},{query:"Single"===e.request._tag?e.request.document.expression:e.request.query,variables:e.request.variables});const o=await T(s,e.fetchOptions.jsonSerializer??C);if(o instanceof Error)throw o;const i={status:s.status,headers:s.headers};if((e=>"Batch"===e._tag?e.executionResults.some(N):N(e.executionResult))(o)&&"none"===r.fetchOptions.errorPolicy){const r="Batch"===o._tag?{...o.executionResults,...i}:{...o.executionResult,...i};return new a(r,{query:"Single"===e.request._tag?e.request.document.expression:e.request.query,variables:e.request.variables})}switch(o._tag){case"Single":return{...i,...R(r)(o.executionResult)};case"Batch":return{...i,data:o.executionResults.map(R(r))};default:h(o)}},R=e=>r=>({extensions:r.extensions,data:r.data,errors:"all"===e.fetchOptions.errorPolicy?r.errors:void 0}),T=async(e,r)=>{const t=e.headers.get(w),s=await e.text();return t&&(e=>{const r=e.toLowerCase();return r.includes(b)||r.includes(v)})(t)?O(r.parse(s)):O(s)},P=e=>async r=>{const t=new Headers(r.headers);let s,a=null;if(t.has(y)||t.set(y,[b,v].join(", ")),"POST"===e){s=(r.fetchOptions.jsonSerializer??C).stringify(_(r)),"string"!=typeof s||t.has(w)||t.set(w,v)}else a=A(r);const n={method:e,headers:t,body:s,...r.fetchOptions};let o=new URL(r.url),i=n;if(r.middleware){const e=await Promise.resolve(r.middleware({...n,url:r.url,operationName:"Single"===r.request._tag?r.request.document.operationName:void 0,variables:r.request.variables})),{url:t,...s}=e;o=new URL(t),i=s}a&&a.forEach(((e,r)=>{o.searchParams.append(r,e)}));const u=r.fetch??fetch;return await u(o,i)},_=e=>{switch(e.request._tag){case"Single":return{query:e.request.document.expression,variables:e.request.variables,operationName:e.request.document.operationName};case"Batch":return i(e.request.query,e.request.variables??[]).map((([e,r])=>({query:e,variables:r})));default:throw h(e.request)}},A=e=>{const r=e.fetchOptions.jsonSerializer??C,t=new URLSearchParams;switch(e.request._tag){case"Single":return t.append("query",x(e.request.document.expression)),e.request.variables&&t.append("variables",r.stringify(e.request.variables)),e.request.document.operationName&&t.append("operationName",e.request.document.operationName),t;case"Batch":{const s=e.request.variables?.map((e=>r.stringify(e)))??[],a=e.request.query.map(x),n=i(a,s).map((([e,r])=>({query:e,variables:r})));return t.append("query",r.stringify(n)),t}default:throw h(e.request)}};class H{url;requestConfig;constructor(e,r={}){this.url=e,this.requestConfig=r}rawRequest=async(...e)=>{const[r,t,s]=e,a=((e,r,t)=>e.query?e:{query:e,variables:r,requestHeaders:t,signal:void 0})(r,t,s),{headers:n,fetch:i=globalThis.fetch,method:c="POST",requestMiddleware:l,responseMiddleware:d,excludeOperationName:h,...p}=this.requestConfig,{url:f}=this;void 0!==a.signal&&(p.signal=a.signal);const m=j(a.query,h),g=await M({url:f,request:{_tag:"Single",document:m,variables:a.variables},headers:{...u(o(n)),...u(a.requestHeaders)},fetch:i,method:c,fetchOptions:p,middleware:l});if(d&&await d(g,{operationName:m.operationName,variables:t,url:this.url}),g instanceof Error)throw g;return g};async request(e,...r){const[t,s]=r,a=B(e,t,s),{headers:n,fetch:i=globalThis.fetch,method:c="POST",requestMiddleware:l,responseMiddleware:d,excludeOperationName:h,...p}=this.requestConfig,{url:f}=this;void 0!==a.signal&&(p.signal=a.signal);const m=j(a.document,h),g=await M({url:f,request:{_tag:"Single",document:m,variables:a.variables},headers:{...u(o(n)),...u(a.requestHeaders)},fetch:i,method:c,fetchOptions:p,middleware:l});if(d&&await d(g,{operationName:m.operationName,variables:a.variables,url:this.url}),g instanceof Error)throw g;return g.data}async batchRequests(e,r){const t=((e,r)=>e.documents?e:{documents:e,requestHeaders:r,signal:void 0})(e,r),{headers:s,excludeOperationName:a,...n}=this.requestConfig;void 0!==t.signal&&(n.signal=t.signal);const i=t.documents.map((({document:e})=>j(e,a))),c=i.map((({expression:e})=>e)),l=i.some((({isMutation:e})=>e)),d=t.documents.map((({variables:e})=>e)),h=await M({url:this.url,request:{_tag:"Batch",operationName:void 0,query:c,hasMutations:l,variables:d},headers:{...u(o(s)),...u(t.requestHeaders)},fetch:this.requestConfig.fetch??globalThis.fetch,method:this.requestConfig.method||"POST",fetchOptions:n,middleware:this.requestConfig.requestMiddleware});if(this.requestConfig.responseMiddleware&&await this.requestConfig.responseMiddleware(h,{operationName:void 0,variables:d,url:this.url}),h instanceof Error)throw h;return h.data}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,r){const{headers:t}=this.requestConfig;return t?t[e]=r:this.requestConfig.headers={[e]:r},this}setEndpoint(e){return this.url=e,this}}async function I(e,r,...t){const s=$(e,r,...t);return new H(s.url).request({...s})}const B=(e,r,t)=>e.document?e:{document:e,variables:r,requestHeaders:t,signal:void 0},$=(e,r,...t)=>{const[s,a]=t;return"string"==typeof e?{url:e,document:r,variables:s,requestHeaders:a,signal:void 0}:e},U=(e,...r)=>e.reduce(((e,t,s)=>`${e}${t}${s in r?String(r[s]):""}`),"");export{a as ClientError,H as GraphQLClient,j as analyzeDocument,f as batchRequests,I as default,U as gql,g as rawRequest,I as request};
//# sourceMappingURL=/sm/ee02c6b92776d331ec94ebeb7388b906e9aa60ec5aa3d6db5c9e4ae1a17dd445.map